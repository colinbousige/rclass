---
title : "R Exercises - Load and plot multiple files"
date  : "`r Sys.Date()`"
output: 
    html_document:
        toc            : yes
        toc_float      : yes
        toc_depth      : 4
        highlight      : tango
        number_sections: false
        code_download  : FALSE
---


In this typical exercise, we will learn how to read multiple files and plot them all together. This is the basic step of data analysis.


- Load the `tidyverse` and `readxl` libraries

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```

- Store into `flist` the list of all `.xls` files in the `Data/` folder. Take a look at the `list.files()`{.R} function for this.

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```

- Open one of the xls files and study the structure of the file. The first group of 2-column data is the blank measurement, while the second group under the blank is the actual raw measurement. Write a function `readFTIR()`{.R} that, given a file name, successively:
    + reads and store the blank data
    + reads and store the raw data
    + returns a data.frame containing the columns `w`, `blank`, `raw`, and `intensity`, the later being `raw` subtracted of `blank`.
    + test it on the first file in the list

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}
readFTIR <- function(filename) {

}
```

- Now we want to read all files in the list and store them in a tidy data.frame. For this we will start easy and use a `for` loop.
    + Define an empty data.frame called `df`
    + Define a `for` loop on all elements of `flist`
    + Then successively:
        + Read the current file with the above-defined function and store it in `tempdf`
        + Add the column `name` to `tempdf` containing the current file name. If needed, trim the path from the name string using `basename()`{.R}.
        + Stack `tempdf` below `df` by binding them row-wise.

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```

- More advanced: you can do this without using a `for` loop using the `tidyverse`

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```

- Plot all these files together using `ggplot2`. You can try several things, like:
    + Plot them all together in one frame with a color depending on the file name.
    + Plot them all on a different frame (facet_wrap) for each file

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}
theme_set(theme_bw()+
          theme(strip.background = element_blank(),
                strip.text = element_text(face="bold")))

```

- You see in the file names that there are actually 4 samples with 2 temperatures for each. Based on the column `name` of the `df` data.frame, create the columns `sample` and `temperature` that contain *numerical values*. Think about using the function `gsub()`{.R} to replace (delete) text in a string, the `substr(string, start, end)`{.R} function to get a portion of a string.

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```

- Now it is time to make nicer plots:
    - Make a grid plot showing the data evolution for each sample as a function of temperature
    - Make a grid plot with one frame per sample, and the two temperatures in different colors

```{r echo=TRUE, warning = FALSE, message=FALSE, cache=FALSE}

```
